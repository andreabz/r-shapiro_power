[
  {
    "objectID": "report.html",
    "href": "report.html",
    "title": "Potenza dei test di normalità nel contesto dei rapporti di validazione per metodi chimici",
    "section": "",
    "text": "Il documento redatto da Eurachem, The Fitness for Purpose of Analytical Methods A Laboratory Guide to Method Validation and Related Topics, sezione 5.7.3, pagina 47, indica di utilizzare 6 - 15 valori per determinare parametri prestazionali quali precisione e giustezza.\nConsiglia inoltre di ispezionare i dati per identificare la presenza di outlier. In molti contesti questo viene declinato nell’utilizzo del test di Grubbs secondo quanto indicato nella norma UNI ISO 5725-2:2019 - Accuratezza (giustezza e precisione) dei risultati e dei metodi di misurazione - Parte 2, sezione 8.3.5, pagina 18.\nTale test è fortemente sensibile a deviazioni dalla normalità dei dati e pertanto si utilizza il test di Shapiro-Wilk per verificare questa assunzione.\nIl test di Shapiro-Wilk è considerato il più potente per un numero ridotto di misure tra i test di normalità disponibili.\nCon questo documento voglio evidenziare come:\n\nil test di Shapiro–Wilk, pur essendo il più potente tra i test di normalità per piccoli campioni, non dispone di potenza sufficiente nelle condizioni operative tipiche dei rapporti di validazione dei metodi chimici,\nla sua applicazione in questo contesto è quindi scarsamente informativa e può indurre un falso senso di sicurezza metodologica."
  },
  {
    "objectID": "report.html#motivazione",
    "href": "report.html#motivazione",
    "title": "Potenza dei test di normalità nel contesto dei rapporti di validazione per metodi chimici",
    "section": "",
    "text": "Il documento redatto da Eurachem, The Fitness for Purpose of Analytical Methods A Laboratory Guide to Method Validation and Related Topics, sezione 5.7.3, pagina 47, indica di utilizzare 6 - 15 valori per determinare parametri prestazionali quali precisione e giustezza.\nConsiglia inoltre di ispezionare i dati per identificare la presenza di outlier. In molti contesti questo viene declinato nell’utilizzo del test di Grubbs secondo quanto indicato nella norma UNI ISO 5725-2:2019 - Accuratezza (giustezza e precisione) dei risultati e dei metodi di misurazione - Parte 2, sezione 8.3.5, pagina 18.\nTale test è fortemente sensibile a deviazioni dalla normalità dei dati e pertanto si utilizza il test di Shapiro-Wilk per verificare questa assunzione.\nIl test di Shapiro-Wilk è considerato il più potente per un numero ridotto di misure tra i test di normalità disponibili.\nCon questo documento voglio evidenziare come:\n\nil test di Shapiro–Wilk, pur essendo il più potente tra i test di normalità per piccoli campioni, non dispone di potenza sufficiente nelle condizioni operative tipiche dei rapporti di validazione dei metodi chimici,\nla sua applicazione in questo contesto è quindi scarsamente informativa e può indurre un falso senso di sicurezza metodologica."
  },
  {
    "objectID": "report.html#metodo",
    "href": "report.html#metodo",
    "title": "Potenza dei test di normalità nel contesto dei rapporti di validazione per metodi chimici",
    "section": "Metodo",
    "text": "Metodo\nSi estraggono da una distribuzione uniforme e una distribuzione lognormale (la Figura 1 mostra un esempio di tali distribuzioni da confrontare con la distribuzione normale) serie di valori di numerosità variabile tra 6 e 15. Si ripete l’estrazione per 10000 volte e si calcola la proporzione di test che rigettano l’ipotesi nulla di normalità (\\(p\\)-value &lt; 0.05): tale valore è la potenza del test.\nLa potenza viene qui definita come la probabilità di rigettare correttamente l’ipotesi nulla di normalità quando i dati non sono normalmente distribuiti.\n\nlibrary(ggplot2)\nlibrary(patchwork)\n\n\nset.seed(123)\n\n# n più grande per visualizzazione\nn_vis &lt;- 1000\n\n# distribuzione uniforme\np1 &lt;- ggplot(data.frame(x = runif(n_vis)), aes(x)) +\n        geom_histogram(aes(y = after_stat(density)), \n                            bins = 15, fill = \"#1b9e77\", alpha = 0.7) +\n        stat_function(fun = dunif,\n                      args = list(min = 0, max = 1),\n                      color = \"red\",\n                      lwd = 1) +\n        labs(title = \"Uniforme\",\n             x = NULL,\n             y = \"Densità di probabilità\") +\n        theme_minimal(base_size = 14)\n\n# distribuzione lognormale\np2 &lt;- ggplot(data.frame(x = rlnorm(n_vis, 0, 1)), aes(x)) +\n        geom_histogram(aes(y = after_stat(density)),\n                        bins = 15,\n                        fill = \"#d95f02\",\n                        alpha = 0.7) +\n        stat_function(fun = dlnorm,\n                      args = list(meanlog = 0, sdlog = 1),\n                      color = \"red\",\n                      lwd = 1) +\n        labs(title = \"Lognormale\",\n             x = NULL,\n             y = \"Densità di probabilità\") +\n        theme_minimal(base_size = 14)\n\n# distribuzione normale (riferimento)\np3 &lt;- ggplot(data.frame(x = rnorm(n_vis, 0, 1)), aes(x)) +\n        geom_histogram(aes(y = after_stat(density)),\n                        bins = 15,\n                        fill = \"grey70\",\n                        alpha = 0.7) +\n        stat_function(fun = dnorm,\n                      args = list(mean = 0, sd = 1),\n                      color = \"red\",\n                      lwd = 1) +\n        labs(title = \"Normale\",\n             x = NULL,\n             y = \"Densità di probabilità\") +\n        theme_minimal(base_size = 14)\n\np1 + p2 + p3 + plot_layout(axes = \"collect\") \n\n\n\n\n\n\n\nFigura 1: Distribuzioni testate vs normale (n=1000 per chiarezza visiva)\n\n\n\n\n\n\nset.seed(123)\nR &lt;- 10000     # numero di campioni bootstrap\nn_vals &lt;- 6:15 # numero di misure simulate secondo Eurachem \nalpha &lt;- 0.05  # livello di significatività del test\n\nresults &lt;- data.frame(\n            n = integer(),\n            distribution = character(),\n            power = numeric()\n            )\n\nfor (n in n_vals) {\n  p_unif &lt;- replicate(R, shapiro.test(runif(n))$p.value)\n  p_lnorm &lt;- replicate(R, shapiro.test(rlnorm(n, 0, 1))$p.value)\n  \n  # proporzione di test statisticamente significativi\n  results &lt;- rbind(results,\n    data.frame(n = n, distribution = \"Uniforme\", power = mean(p_unif &lt; alpha)),\n    data.frame(n = n, distribution = \"Lognormale\", power = mean(p_lnorm &lt; alpha))\n  )\n}\n\n\n# valore limite di n per cui\n# viene raggiunta la potenza dell'80% per\n# almeno per una distribuzione testata\nn_limite &lt;- results |&gt;\n  subset(power &lt; 0.8) |&gt;\n  aggregate(power ~ n, data = _, FUN = length) |&gt;\n  subset(power == length(unique(results$distribution))) |&gt;\n  _[, \"n\"] |&gt; \n  max()"
  },
  {
    "objectID": "report.html#risultati",
    "href": "report.html#risultati",
    "title": "Potenza dei test di normalità nel contesto dei rapporti di validazione per metodi chimici",
    "section": "Risultati",
    "text": "Risultati\nLa Figura 2 mostra come la potenza risulti &lt;80% fino a 14 per entrambe le distribuzioni.\nIn termini pratici, ciò significa che nelle condizioni di numerosità raccomandate dalle linee guida Eurachem il test di Shapiro–Wilk fallisce frequentemente nell’individuare deviazioni anche marcate dalla normalità.\nIn particolare,\n\nper il caso limite di una distribuzione lognormale con media e deviazione standard pari rispettivamente a 0 e 1, la potenza dell’80% viene raggiunta solo per serie di 15, mentre rimane al di sotto del 70% fino a 12 valori.\nper il caso limite di una distribuzione uniforme tra 0 e 1, il test non supera il valore di potenza del 12% sull’intero intervallo del numero di misure testato.\n\n\nggplot(results, aes(x = n, y = power, colour = distribution)) +\n  geom_line(linewidth = 1) +\n  geom_point(size = 3) +\n  \n  geom_hline(\n    yintercept = 0.80,\n    linetype = \"dashed\",\n    colour = \"grey40\"\n  ) +\n  \n  scale_colour_manual(\n    values = c(\n      \"Uniforme\"   = \"#1b9e77\",\n      \"Lognormale\" = \"#d95f02\"\n    )\n  ) +\n  \n  scale_x_continuous(\n    breaks = sort(unique(results$n))\n  ) +\n  \n  scale_y_continuous(\n    limits = c(0, 1),\n    labels = scales::label_percent(accuracy = 1)\n  ) +\n  \n  labs(\n    title = \"Potenza del test di Shapiro–Wilk per 6-15 valori\",\n    subtitle = \"Probabilità di rifiutare l’ipotesi di normalità (α = 0.05)\",\n    x = \"Numero di prove (n)\",\n    y = \"Potenza del test (P[p &lt; 0.05])\",\n    colour = \"Distribuzione\"\n  ) +\n  \n  theme_minimal(base_size = 14) +\n  theme(\n    legend.position = \"bottom\",\n    plot.title = element_text(face = \"bold\"),\n    panel.grid.minor = element_blank()\n  )\n\n\n\n\n\n\n\nFigura 2: Andamento della potenza del test Shapiro-Wilk con set di dati compresi tra 6 e 15 estratti da distribuzioni uniformi e lognormali."
  },
  {
    "objectID": "report.html#conclusioni",
    "href": "report.html#conclusioni",
    "title": "Potenza dei test di normalità nel contesto dei rapporti di validazione per metodi chimici",
    "section": "Conclusioni",
    "text": "Conclusioni\nNel contesto della valutazione della normalità delle misure prodotte in sede di validazione da metodi di prova chimici, la verifica della normalità mediante test di Shapiro-Wilk risulta priva della potenza necessaria a tale scopo. Questo non implica che i dati siano normali, ma che il test non ha potere sufficiente per accorgersi quando non lo sono.\nConsiglio di evitare la verifica del test della normalità, valutando l’eventuale presenza di valori anomali mediante test robusti basati su median absolute deviation (MAD).\nPer esperienza personale, quando con un numero di valori compreso tra 6 e 15 il test di Shapiro-Wilk mi ha indicato di rigettare l’ipotesi nulla di distribuzione normale dei dati, il più delle volte si è trattato di errori di arrotondamento che facevano risultare valori simili come numericamente identici."
  }
]